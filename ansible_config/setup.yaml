---
- name: Deploy common packages
  hosts: all
  become: true
  roles:
    - commons
    - configure-kernel
    - containerd

# ====== Setup & Configure Master Node ==============
- name: Setup Master
  hosts: master
  become: true
  roles:
    - smbshare-setup
    - cluster-setup

# ==== Play to setup and configure k8s worker nodes ==========
- name: Join cluster
  hosts: worker
  become: true
  roles:
    - smbshare-mounting
    - worker-setup
  tags: worker_block

# # === Testing ===
# - name: Export IP details
#   hosts: master
#   become: true
#   tasks:
#     - name: Display IPv4 Addresses
#       ansible.builtin.shell: |
#         touch /home/ubuntu/ips.txt
#         echo {{ ansible_host }} > /home/ubuntu/ips.txt
#   tags: test_tag
